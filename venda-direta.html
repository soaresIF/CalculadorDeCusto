<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venda Direta / Custo Puro</title>
    <style>
        /* Mudei a cor principal para ROXO para você saber que está na Venda Direta */
        :root { --primary: #7c3aed; --bg: #f5f3ff; --card: #ffffff; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        
        /* Botão de Voltar */
        .nav-container { text-align: center; margin-bottom: 15px; }
        .btn-voltar {
            background-color: #000000; 
            color: white; 
            text-decoration: none; 
            padding: 10px 20px; 
            border-radius: 20px; 
            font-weight: bold; 
            font-size: 0.9rem; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: inline-block;
        }
        .btn-voltar:hover { background-color: #b91c1c; }

        .container { width: 95%; max-width: 800px; margin: 0 auto; background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); box-sizing: border-box; }
        h1 { text-align: center; color: var(--primary); font-size: 1.5rem; margin-bottom: 20px; }
        
        .input-produto { width: 100%; padding: 12px; font-size: 1.1em; margin-bottom: 20px; border: 2px solid #000000; border-radius: 6px; box-sizing: border-box; }
        
        .item-row { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; flex-wrap: wrap; }
        .item-label { flex: 3; min-width: 150px; font-weight: 500; color: #475569; }
        
        input { padding: 10px; border: 1px solid #000000; border-radius: 4px; box-sizing: border-box; }
        input[type="number"] { flex: 1; min-width: 80px; }
        input[type="text"] { flex: 3; min-width: 150px; }
        
        .btn { cursor: pointer; padding: 12px 20px; border: none; border-radius: 6px; font-weight: bold; display: block; width: 100%; margin-top: 10px; }
        .btn-add { background: #10b981; color: white; margin-bottom: 20px; }
        .btn-calc { background: var(--primary); color: white; font-size: 1.1em; }
        .btn-print { background: #334155; color: white; margin-top: 15px; }
        
        /* Botão de limpar */
        .btn-clear { background: #f59e0b; color: white; margin-top: 10px; }
        .btn-clear:hover { background: #d97706; }

        #resultado { margin-top: 25px; padding: 15px; background: #ede9fe; border-radius: 8px; display: none; border: 1px solid #ddd6fe; }
        .res-linha { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px dashed #c4b5fd; }
        
        .box-valores {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }
        
        .valor-card {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .sem-nota { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .com-nota { background: #e0e7ff; color: #3730a3; border: 1px solid #c7d2fe; }

        .valor-grande { font-size: 1.6em; font-weight: bold; display: block; margin-top: 5px; }
        
        .remove-btn { background: #ef4444; color: white; border: none; border-radius: 4px; padding: 10px 12px; cursor: pointer; }

        @media (max-width: 480px) { 
            .item-label, input[type="text"] { flex: 100%; } 
            .box-valores { flex-direction: column; }
        }
        
        @media print { 
            .no-print, .nav-container, .btn, .remove-btn { display: none !important; } 
            .container { box-shadow: none; border: none; width: 100%; } 
            #resultado { display: block !important; background: white; border: none; } 
            #nome-produto-input { display: none; }
            .box-valores { display: block; }
            .valor-card { border: 1px solid #000; margin-bottom: 10px; page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="nav-container no-print">
    <a href="index.html" class="btn-voltar">Voltar para Central de Custos</a>
</div>

<div class="container">
    <h1>Venda Direta (Soma Simples)</h1>
    <input type="text" id="nome-produto-input" class="input-produto no-print" placeholder="Nome do Produto / Referência" oninput="salvarDados()">
    <div class="file-controls no-print" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button onclick="exportarDados()" style="background: #0ea5e9; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; flex: 1; font-weight: bold;">
            ⬇ Salvar Arquivo
        </button>
        <button onclick="document.getElementById('input-arquivo').click()" style="background: #8b5cf6; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; flex: 1; font-weight: bold;">
            ⬆ Abrir Arquivo
        </button>
        <input type="file" id="input-arquivo" accept=".json" style="display: none;" onchange="carregarArquivo(this)">
    </div>

    <div id="lista-itens" class="no-print"></div>

    <button class="btn btn-add no-print" onclick="adicionarItemCustom('', '')">+ Adicionar Outro Item</button>
    
    <button class="btn btn-calc no-print" onclick="calcular()">CALCULAR CUSTOS</button>

    <div id="resultado">
        <h2 id="titulo-relatorio" style="text-align: center; color: var(--primary); margin-top: 0;">Relatório de Venda Direta</h2>
        <p id="data-impressao" style="text-align: center; font-size: 0.9em; color: #64748b; margin-top: -15px; margin-bottom: 20px;"></p>
        <div id="detalhes-relatorio"></div>
        <hr>
        
        <div class="box-valores">
            <div class="valor-card sem-nota">
                <span>Total (Sem Nota)</span>
                <span class="valor-grande" id="valSemNota">R$ 0,00</span>
                <small>Soma exata dos itens</small>
            </div>
            <div class="valor-card com-nota">
                <span>Total (Com Nota 6%)</span>
                <span class="valor-grande" id="valComNota">R$ 0,00</span>
                <small>Valor para cobrir imposto</small>
            </div>
        </div>
    </div>
    <button class="btn btn-print no-print" onclick="window.print()">IMPRIMIR RELATÓRIO</button>
    <button class="btn btn-clear no-print" onclick="limparTudo()">Limpar Tudo</button>
</div>

<script>
    const itensPadrao = ["Sola", "Pintura Sola", "Facheta Salto", "Palmilha", "Cabedal", "Estampa", "Bordado", "Emborrachado", "Enfeite", "Strass", "Tira", "Gorgurão", "Elastico", "Fivela", "Velcro", "Ilhós", "Cordão", "Caixa", "Cola/solvente", "Etiqueta", "Linha", "Despesas fixa", "Corte", "Pesponto", "Montagem", "Enfachetar salto", "Waster","LUCRO"];
    const listaDiv = document.getElementById('lista-itens');

    function init() {
        carregarItensPadrao();
        carregarStorage();
    }

    function carregarItensPadrao() {
        itensPadrao.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item-row padrao';
            div.innerHTML = `<div class="item-label">${item}</div><input type="number" step="0.01" class="item-valor" data-label="${item}" oninput="salvarDados()"><button class="remove-btn" onclick="limparInput(this)">X</button>`;
            listaDiv.appendChild(div);
        });
    }

    function limparInput(btn) {
        const input = btn.parentElement.querySelector('input');
        input.value = '';
        salvarDados();
    }

    function adicionarItemCustom(nome = '', valor = '') {
        const div = document.createElement('div');
        div.className = 'item-row custom';
        div.innerHTML = `<input type="text" placeholder="Nome do item" class="item-nome-custom" value="${nome}" oninput="salvarDados()"><input type="number" step="0.01" class="item-valor" value="${valor}" oninput="salvarDados()"><button class="remove-btn" onclick="removerCustom(this)">X</button>`;
        listaDiv.appendChild(div);
    }

    function removerCustom(btn) {
        btn.parentElement.remove();
        salvarDados();
    }

    // --- STORAGE (Chaves diferentes para não misturar com a Shopee) ---
    function salvarDados() {
        localStorage.setItem('dir_nome', document.getElementById('nome-produto-input').value);

        const valoresPadrao = {};
        document.querySelectorAll('.item-row.padrao .item-valor').forEach(input => {
            if(input.value) valoresPadrao[input.dataset.label] = input.value;
        });
        localStorage.setItem('dir_padrao', JSON.stringify(valoresPadrao));

        const customizados = [];
        document.querySelectorAll('.item-row.custom').forEach(row => {
            const nome = row.querySelector('.item-nome-custom').value;
            const valor = row.querySelector('.item-valor').value;
            if(nome || valor) customizados.push({nome, valor});
        });
        localStorage.setItem('dir_custom', JSON.stringify(customizados));
    }

    function carregarStorage() {
        if(localStorage.getItem('dir_nome')) {
            document.getElementById('nome-produto-input').value = localStorage.getItem('dir_nome');
        }

        const valoresPadrao = JSON.parse(localStorage.getItem('dir_padrao')) || {};
        document.querySelectorAll('.item-row.padrao .item-valor').forEach(input => {
            if(valoresPadrao[input.dataset.label]) {
                input.value = valoresPadrao[input.dataset.label];
            }
        });

        const customizados = JSON.parse(localStorage.getItem('dir_custom')) || [];
        customizados.forEach(item => {
            adicionarItemCustom(item.nome, item.valor);
        });
    }

    function limparTudo() {
        if (confirm("Apagar todos os dados desta página?")) {
            localStorage.removeItem('dir_nome');
            localStorage.removeItem('dir_padrao');
            localStorage.removeItem('dir_custom');
            location.reload();
        }
    }

    function calcular() {
        const rows = document.querySelectorAll('.item-row');
        let somaBase = 0;
        let htmlRelatorio = '';

        rows.forEach(row => {
            const valInput = row.querySelector('.item-valor');
            const valor = parseFloat(valInput.value);
            if (valor > 0) {
                const label = row.querySelector('.item-label');
                const nome = label ? label.innerText : row.querySelector('.item-nome-custom').value;
                somaBase += valor;
                htmlRelatorio += `<div class="res-linha"><span>${nome || 'Item'}</span><span>R$ ${valor.toFixed(2)}</span></div>`;
            }
        });

        if (somaBase === 0) return alert("Insira pelo menos um valor.");

        // Cálculo Simples
        const semNota = somaBase;
        
        // Cálculo com Nota 6% (Markup divisor)
        // Usamos divisão por 0.94 para que o valor final cubra o custo + os 6% do valor cheio.
        const comNota = somaBase / 0.94;

        document.getElementById('titulo-relatorio').innerText = document.getElementById('nome-produto-input').value || "Relatório de Venda Direta";
        document.getElementById('detalhes-relatorio').innerHTML = htmlRelatorio;
        
        document.getElementById('valSemNota').innerText = `R$ ${semNota.toFixed(2)}`;
        document.getElementById('valComNota').innerText = `R$ ${comNota.toFixed(2)}`;

        const dataHoje = new Date();
        const dataFormatada = dataHoje.toLocaleDateString('pt-BR', {
        day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit'
        });
        
        document.getElementById('data-impressao').innerText = "Gerado em: " + dataFormatada;
      
        document.getElementById('resultado').style.display = 'block';
        window.scrollTo({ top: document.getElementById('resultado').offsetTop, behavior: 'smooth' });
    }
    // --- SISTEMA DE ARQUIVOS (EXPORTAR/IMPORTAR) ---

    function exportarDados() {
        const nomeArquivo = (document.getElementById('nome-produto-input').value || "produto-sem-nome") + ".json";
        
        // 1. Coleta os dados (Mesma lógica do SalvarStorage)
        const dados = {
            nome: document.getElementById('nome-produto-input').value,
            padrao: {},
            custom: []
        };

        // Coleta itens padrão
        document.querySelectorAll('.item-row.padrao .item-valor').forEach(input => {
            if(input.value) dados.padrao[input.dataset.label] = input.value;
        });

        // Coleta itens customizados
        document.querySelectorAll('.item-row.custom').forEach(row => {
            const nome = row.querySelector('.item-nome-custom').value;
            const valor = row.querySelector('.item-valor').value;
            if(nome || valor) dados.custom.push({nome, valor});
        });

        // 2. Cria o arquivo para download
        const jsonString = JSON.stringify(dados, null, 2);
        const blob = new Blob([jsonString], { type: "application/json" });
        const link = document.createElement("a");
        
        link.href = URL.createObjectURL(blob);
        link.download = nomeArquivo;
        link.click();
    }

    function carregarArquivo(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const dados = JSON.parse(e.target.result);

                if (confirm(`Deseja carregar os dados do arquivo "${file.name}"? Isso substituirá o que está na tela.`)) {
                    // 1. Preenche Nome
                    document.getElementById('nome-produto-input').value = dados.nome || "";

                    // 2. Preenche Padrão (Limpa antes os atuais para evitar lixo)
                    document.querySelectorAll('.item-row.padrao .item-valor').forEach(inp => inp.value = "");
                    for (const [key, value] of Object.entries(dados.padrao || {})) {
                        const input = document.querySelector(`.item-row.padrao .item-valor[data-label="${key}"]`);
                        if (input) input.value = value;
                    }

                    // 3. Preenche Customizados (Remove os atuais e recria)
                    document.querySelectorAll('.item-row.custom').forEach(el => el.remove());
                    if (dados.custom && dados.custom.length > 0) {
                        dados.custom.forEach(item => adicionarItemCustom(item.nome, item.valor));
                    }

                    // 4. Salva no LocalStorage para não perder se der F5 agora
                    salvarDados();
                    alert("Dados carregados com sucesso!");
                }
            } catch (erro) {
                alert("Erro ao ler arquivo. Verifique se é um backup válido.");
                console.error(erro);
            }
        };
        reader.readAsText(file);
        
        // Limpa o input para permitir carregar o mesmo arquivo 2x seguidas se precisar
        input.value = ""; 
    }

    init();
</script>
</body>

</html>





